_format_version: "3.0"
services:
#  services and their routes
  - name: kong-microservices-config-service
    url: http://kong-microservices-config-service:8280
    routes:
      - name: route-0
        paths:
          - /ms-config-svc-api
        strip_path: false

  - name: k8s-kafka-avro-kong-bs-ms-address
    url: http://k8s-kafka-avro-kong-bs-ms-address:8681
    routes:
      - name: route-1
        paths:
          - /address-api
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
  - name: k8s-kafka-avro-kong-bs-ms-company
    url: http://k8s-kafka-avro-kong-bs-ms-company:8682
    routes:
      - name: route-2
        paths:
          - /company-api
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE

  - name: k8s-kafka-avro-kong-bs-ms-employee
    url: http://k8s-kafka-avro-kong-bs-ms-employee:8683
    routes:
      - name: route-3
        paths:
          - /employee-api
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE

  - name: k8s-kafka-avro-kong-bs-ms-project
    url: http://k8s-kafka-avro-kong-bs-ms-project:8684
    routes:
      - name: route-4
        paths:
          - /project-api
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE

  #global plugins: rate-limiting,proxy-cache,authentication
plugins:
  - name: file-log
    config:
      path: "/opt/logs-file.log"
  - name: rate-limiting
    config:
      minute: 5
      policy: local
  - name: proxy-cache
    config:
      response_code:
        - 200
      request_method:
        - GET
      content_type:
        - text/plain
        - application/json
      cache_ttl: 300
      strategy: memory
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - DELETE
        - PUT
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - X-Auth-Token
      exposed_headers:
        - X-Auth-Token
      credentials: true
      max_age: 3600
  - name: ip-restriction
    config:
      deny:
        - 54.13.21.1
        - 143.1.0.0/24
  - name: jwt
    enabled: true
    config:
        key_claim_name: key_id
        claims_to_verify:
          - exp #activate expiration datetime
consumers:
  - username: admin1
    custom_id: admin2023-11-03:12:51
  - username: admin2
    custom_id: admin2-2023-11-03:12:51
# credentials for jwt authentication plugin
jwt_secrets:
  - consumer: admin1
    secret: "use_to_sign_token"
  - consumer: admin2
    secret: "use_to_sign_token"